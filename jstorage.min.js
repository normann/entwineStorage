(function(g){function m(){if(e.EntwineStorage)try{c=n(""+e.EntwineStorage)}catch(a){e.EntwineStorage="{}"}else e.EntwineStorage="{}";j=e.EntwineStorage?(""+e.EntwineStorage).length:0}function h(){try{e.EntwineStorage=o(c),d&&(d.setAttribute("EntwineStorage",e.EntwineStorage),d.save("EntwineStorage")),j=e.EntwineStorage?(""+e.EntwineStorage).length:0}catch(a){}}function i(a){if(!a||"string"!=typeof a&&"number"!=typeof a)throw new TypeError("Key name must be string or numeric");if("__entstorage_meta"==a)throw new TypeError("Reserved key name");return!0}function k(){var a,
b,d,e=Infinity,f=!1;clearTimeout(p);if(c.__entstorage_meta&&"object"==typeof c.__entstorage_meta.TTL){a=+new Date;d=c.__entstorage_meta.TTL;for(b in d)d.hasOwnProperty(b)&&(d[b]<=a?(delete d[b],delete c[b],f=!0):d[b]<e&&(e=d[b]));Infinity!=e&&(p=setTimeout(k,e-a));f&&h()}}if(!g||!g.toJSON&&!Object.toJSON&&!window.JSON)throw Error("jQuery, MooTools or Prototype needs to be loaded before EntwineStorage!");var c={},e={EntwineStorage:"{}"},d=null,j=0,o=g.toJSON||Object.toJSON||window.JSON&&(JSON.encode||JSON.stringify),
n=g.evalJSON||window.JSON&&(JSON.decode||JSON.parse)||function(a){return(""+a).evalJSON()},f=!1,p,l={isXML:function(a){return(a=(a?a.ownerDocument||a:0).documentElement)?"HTML"!==a.nodeName:!1},encode:function(a){if(!this.isXML(a))return!1;try{return(new XMLSerializer).serializeToString(a)}catch(b){try{return a.xml}catch(c){}}return!1},decode:function(a){var b="DOMParser"in window&&(new DOMParser).parseFromString||window.ActiveXObject&&function(a){var b=new ActiveXObject("Microsoft.XMLDOM");b.async=
"false";b.loadXML(a);return b};if(!b)return!1;a=b.call("DOMParser"in window&&new DOMParser||window,a,"text/xml");return this.isXML(a)?a:!1}};g.EntwineStorage={version:"0.1.6.1",set:function(a,b){i(a);if(l.isXML(b))b={_is_xml:!0,xml:l.encode(b)};else{if("function"==typeof b)return;b&&"object"==typeof b&&(b=n(o(b)))}c[a]=b;h();return b},get:function(a,b){i(a);return a in c?c[a]&&"object"==typeof c[a]&&c[a]._is_xml&&c[a]._is_xml?l.decode(c[a].xml):c[a]:"undefined"==typeof b?null:b},deleteKey:function(a){i(a);
return a in c?(delete c[a],c.__entstorage_meta&&"object"==typeof c.__entstorage_meta.TTL&&a in c.__entstorage_meta.TTL&&delete c.__entstorage_meta.TTL[a],h(),!0):!1},setTTL:function(a,b){var d=+new Date;i(a);b=Number(b)||0;if(a in c){if(!c.__entstorage_meta)c.__entstorage_meta={};if(!c.__entstorage_meta.TTL)c.__entstorage_meta.TTL={};0<b?c.__entstorage_meta.TTL[a]=d+b:delete c.__entstorage_meta.TTL[a];h();k();return!0}return!1},flush:function(){c={};h();return!0},storageObj:function(){function a(){}a.prototype=c;return new a},
index:function(){var a=[],b;for(b in c)c.hasOwnProperty(b)&&"__entstorage_meta"!=b&&a.push(b);return a},storageSize:function(){return j},currentBackend:function(){return f},storageAvailable:function(){return!!f},reInit:function(){var a;if(d&&d.addBehavior){a=document.createElement("link");d.parentNode.replaceChild(a,d);d=a;d.style.behavior="url(#default#userData)";document.getElementsByTagName("head")[0].appendChild(d);d.load("EntwineStorage");a="{}";try{a=d.getAttribute("EntwineStorage")}catch(b){}e.EntwineStorage=
a;f="userDataBehavior"}m()}};(function(){var a=!1;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval"),a=!0,window.localStorage.removeItem("_tmptest")}catch(b){}if(a)try{if(window.localStorage)e=window.localStorage,f="localStorage"}catch(c){}else if("globalStorage"in window)try{window.globalStorage&&(e=window.globalStorage[window.location.hostname],f="globalStorage")}catch(g){}else if(d=document.createElement("link"),d.addBehavior){d.style.behavior="url(#default#userData)";
document.getElementsByTagName("head")[0].appendChild(d);d.load("EntwineStorage");a="{}";try{a=d.getAttribute("EntwineStorage")}catch(h){}e.EntwineStorage=a;f="userDataBehavior"}else{d=null;return}m();k()})()})(window.jQuery||window.$);